---
title: "Git Reset æ­ç§˜ï¼šä¸‰æ£µæ ‘ç†è®º"
description: "æ·±å…¥ç†è§£ Git çš„æ ¸å¿ƒæœºåˆ¶â€”â€”HEADã€æš‚å­˜åŒºä¸å·¥ä½œç›®å½•ã€‚å½»åº•ææ‡‚ soft, mixed å’Œ hard é‡ç½®çš„åŒºåˆ«ã€‚"
---

`git reset` æ˜¯ Git ä¸­æœ€ä»¤äººå›°æƒ‘ä½†ä¹Ÿæœ€å¼ºå¤§çš„å‘½ä»¤ä¹‹ä¸€ã€‚å¾ˆå¤šæ•™ç¨‹åªå‘Šè¯‰ä½ â€œç”¨è¿™ä¸ªå‘½ä»¤æ’¤é”€æäº¤â€ï¼Œä½†å¦‚æœä¸ç†è§£èƒŒåçš„åŸç†ï¼Œå¾ˆå®¹æ˜“è¯¯åˆ ä»£ç ã€‚

è¦æŒæ¡ `reset`ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç†è§£ Git çš„**ä¸‰æ£µæ ‘**æ¨¡å‹ã€‚

## 1. Git çš„â€œä¸‰æ£µæ ‘â€ (The Three Trees)

åœ¨ Git ä¸­ï¼Œâ€œæ ‘â€æŒ‡çš„æ˜¯æ–‡ä»¶é›†åˆçš„å¿«ç…§ã€‚

| æ ‘ (Tree) | æè¿° | ä½œç”¨ |
| :--- | :--- | :--- |
| **HEAD** | æŒ‡å‘å½“å‰åˆ†æ”¯å¼•ç”¨çš„æŒ‡é’ˆ | é€šå¸¸æŒ‡å‘å½“å‰åˆ†æ”¯åï¼Œé—´æ¥æŒ‡å‘æœ€åä¸€æ¬¡æäº¤ã€‚ |
| **Index (æš‚å­˜åŒº)** | é¢„æœŸçš„ä¸‹ä¸€æ¬¡æäº¤ | `git add` åçš„åŒºåŸŸï¼Œå‡†å¤‡ç”Ÿæˆçš„å¿«ç…§ã€‚ |
| **Working Directory (å·¥ä½œç›®å½•)** | æ²™ç›’ | ä½ åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å®é™…çœ‹åˆ°å’Œç¼–è¾‘çš„æ–‡ä»¶ã€‚ |

å½“ä½ è¿è¡Œ `git commit` æ—¶ï¼ŒGit å®é™…ä¸Šæ˜¯æŠŠ **Index** çš„çŠ¶æ€ä¿å­˜ä¸ºä¸€ä¸ªæ°¸ä¹…çš„å¿«ç…§ï¼Œå¹¶æ›´æ–° **HEAD** æŒ‡å‘å®ƒã€‚

## 2. Reset çš„ä¸‰ç§æ¨¡å¼

`git reset` çš„æœ¬è´¨æ˜¯**ç§»åŠ¨ HEAD æŒ‡é’ˆ**ã€‚ä½†æ ¹æ®å‚æ•°ä¸åŒï¼Œå®ƒä¼šå†³å®šæ˜¯å¦åŒæ­¥æ›´æ–° Index å’Œ Working Directoryã€‚

å‡è®¾æˆ‘ä»¬è¦æ’¤é”€æœ€è¿‘çš„ä¸€æ¬¡æäº¤ï¼ˆå›åˆ° `v1` çŠ¶æ€ï¼‰ï¼Œä»¥ä¸‹æ˜¯ä¸‰ç§æ¨¡å¼çš„åŒºåˆ«ï¼š

### 2.1 Soft Reset (`--soft`)

```bash
git reset --soft HEAD~1
```

- **HEAD**: ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªæäº¤ã€‚
- **Index**: **ä¸å˜**ï¼ˆä¿ç•™äº†åŸå…ˆ commit çš„å†…å®¹ï¼‰ã€‚
- **Working Directory**: **ä¸å˜**ã€‚

**ç»“æœ**ï¼šä½ åˆšåˆšæäº¤çš„æ”¹åŠ¨å›åˆ°äº†**æš‚å­˜åŒº**ï¼ˆStagedï¼‰ã€‚
**åœºæ™¯**ï¼šä½ æäº¤äº†ä»£ç ï¼Œä½†æƒ³æ’¤é”€æäº¤åŠ¨ä½œï¼Œä¿ç•™ä»£ç å¹¶é‡æ–° commitï¼ˆæ¯”å¦‚ä¸ºäº†åˆå¹¶å¤šä¸ª commitï¼‰ã€‚

### 2.2 Mixed Reset (`--mixed`) â€”â€” **é»˜è®¤æ¨¡å¼**

```bash
git reset HEAD~1
# ç­‰åŒäº git reset --mixed HEAD~1
```

- **HEAD**: ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªæäº¤ã€‚
- **Index**: **é‡ç½®**ï¼ˆåŒæ­¥ä¸º HEAD çš„å†…å®¹ï¼‰ã€‚
- **Working Directory**: **ä¸å˜**ã€‚

**ç»“æœ**ï¼šä½ æäº¤çš„æ”¹åŠ¨å›åˆ°äº†**å·¥ä½œç›®å½•**ï¼Œå¹¶ä¸”æ˜¯**æœªæš‚å­˜**ï¼ˆUnstagedï¼‰çš„çŠ¶æ€ã€‚
**åœºæ™¯**ï¼šä½ æƒ³å®Œå…¨æ’¤é”€ commit å’Œ add æ“ä½œï¼Œé‡æ–°åœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šå·¥ä½œã€‚

### 2.3 Hard Reset (`--hard`)

:::danger[é«˜å±æ“ä½œ]
æ­¤æ“ä½œä¼šæ°¸ä¹…åˆ é™¤æœªæäº¤çš„æ”¹åŠ¨ï¼
:::

```bash
git reset --hard HEAD~1
```

- **HEAD**: ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªæäº¤ã€‚
- **Index**: **é‡ç½®**ã€‚
- **Working Directory**: **é‡ç½®**ã€‚

**ç»“æœ**ï¼šå›åˆ°ä¸Šä¸€ä¸ªæäº¤çš„çŠ¶æ€ã€‚ä½ åœ¨è¯¥æäº¤ä¹‹åçš„å·¥ä½œç›®å½•ä¿®æ”¹ä¼šä¸¢å¤±ã€‚
**åœºæ™¯**ï¼šå½»åº•æ”¾å¼ƒå½“å‰çš„ä¹±ä¸ƒå…«ç³Ÿçš„æ”¹åŠ¨ï¼Œé‡å¤´å†æ¥ã€‚

:::tip[å¹¶ä¸æ€»æ˜¯å®Œå…¨ä¸¢å¤±]
å¯¹äºå·²ç» Commit è¿‡çš„å†å²ï¼Œå¦‚æœä½ è¯¯ç”¨äº† Hard Resetï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ `git reflog` æ‰¾å›é‚£ä¸ª Commit çš„å“ˆå¸Œå€¼å¹¶æ¢å¤ã€‚
ä½†æ˜¯ï¼Œ**æœªæäº¤çš„å·¥ä½œç›®å½•ä¿®æ”¹**ï¼ˆUnstaged changesï¼‰ä¸€æ—¦ Hard Resetï¼Œå°±çœŸçš„æ‰¾ä¸å›æ¥äº†ã€‚
:::

## 3. å¯è§†åŒ–æµç¨‹

ä¸‹é¢çš„æµç¨‹å›¾å±•ç¤ºäº† `reset` å¦‚ä½•å½±å“è¿™ä¸‰ä¸ªåŒºåŸŸã€‚å‡è®¾æˆ‘ä»¬å¤„äº Commit v2ï¼Œæƒ³é€€å› v1ã€‚

```mermaid
graph TD
    subgraph States [çŠ¶æ€å˜åŒ–]
        v2[å½“å‰çŠ¶æ€: v2]
        soft[Soft Reset: ä»…ç§»åŠ¨ HEAD]
        mixed[Mixed Reset: ç§»åŠ¨ HEAD + é‡ç½® Index]
        hard[Hard Reset: ç§»åŠ¨ HEAD + é‡ç½® Index + é‡ç½® WorkDir]
    end

    v2 -->|git reset --soft v1| soft
    v2 -->|git reset --mixed v1| mixed
    v2 -->|git reset --hard v1| hard

    style soft fill:#d4edda,stroke:#28a745,color:#155724
    style mixed fill:#fff3cd,stroke:#ffc107,color:#856404
    style hard fill:#f8d7da,stroke:#dc3545,color:#721c24
```

### è¯¦ç»†å¯¹æ¯”è¡¨

| å‘½ä»¤ | ç§»åŠ¨ HEAD? | æ›´æ–° Index? | æ›´æ–°å·¥ä½œç›®å½•? | ä½ çš„æ”¹åŠ¨å»å“ªäº†? |
| :--- | :---: | :---: | :---: | :--- |
| `--soft` | âœ… | âŒ | âŒ | **æš‚å­˜åŒº (Staged)** |
| `--mixed` | âœ… | âœ… | âŒ | **å·¥ä½œç›®å½• (Unstaged)** |
| `--hard` | âœ… | âœ… | âœ… | **ğŸ—‘ï¸ å½»åº•æ¶ˆå¤±** |

## 4. æ€»ç»“

- æƒ³æ’¤é”€ commit ä½†ä¿ç•™ä»£ç ç»§ç»­æäº¤ï¼Ÿç”¨ `--soft`ã€‚
- æƒ³æ’¤é”€ commit å’Œ addï¼ŒæŠŠä»£ç æ‰“å›åŸå½¢ç»§ç»­ä¿®æ”¹ï¼Ÿç”¨ `--mixed`ï¼ˆé»˜è®¤ï¼‰ã€‚
- ä»£ç å†™çƒ‚äº†æƒ³å½»åº•é‡æ¥ï¼Ÿç”¨ `--hard`ï¼ˆ**æ…ç”¨**ï¼‰ã€‚

ç†è§£äº†â€œä¸‰æ£µæ ‘â€ï¼Œä½ å°±æŒæ¡äº† Git æ—¶é—´æ—…è¡Œçš„é’¥åŒ™ã€‚
